<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 9">
<meta name=Originator content="Microsoft Word 9">
<link rel=File-List href="./QMP-2-changes_files/filelist.xml">
<title>Changes for QMP Version 2</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Chip Watson</o:Author>
  <o:LastAuthor>Chip Watson</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>752</o:TotalTime>
  <o:Created>2004-11-02T15:04:00Z</o:Created>
  <o:LastSaved>2004-11-02T15:04:00Z</o:LastSaved>
  <o:Pages>4</o:Pages>
  <o:Words>1061</o:Words>
  <o:Characters>6048</o:Characters>
  <o:Company>SURA / Jefferson Lab</o:Company>
  <o:Lines>50</o:Lines>
  <o:Paragraphs>12</o:Paragraphs>
  <o:CharactersWithSpaces>7427</o:CharactersWithSpaces>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:TargetScreenSize>1600x1200</o:TargetScreenSize>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:Helvetica;
	panose-1:2 11 6 4 2 2 2 2 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536902279 -2147483648 8 0 511 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	text-align:center;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	mso-font-kerning:14.0pt;
	font-weight:bold;}
p.MsoBodyTextIndent, li.MsoBodyTextIndent, div.MsoBodyTextIndent
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:63.0pt;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	text-align:center;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	font-style:italic;}
p.MsoBodyTextIndent2, li.MsoBodyTextIndent2, div.MsoBodyTextIndent2
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:1.0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoBodyTextIndent3, li.MsoBodyTextIndent3, div.MsoBodyTextIndent3
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:1.0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Helvetica;
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
p.MsoBlockText, li.MsoBlockText, div.MsoBlockText
	{margin-top:6.0pt;
	margin-right:.7in;
	margin-bottom:0in;
	margin-left:1.5in;
	margin-bottom:.0001pt;
	text-indent:-.5in;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:Helvetica;
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in .8in .8in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
@list l0
	{mso-list-id:1048072399;
	mso-list-type:hybrid;
	mso-list-template-ids:-1115810998 760502080 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l0:level1
	{mso-level-number-format:roman-upper;
	mso-level-tab-stop:.75in;
	mso-level-number-position:left;
	margin-left:.75in;
	text-indent:-.5in;}
@list l0:level2
	{mso-level-number-format:alpha-lower;
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l0:level3
	{mso-level-number-format:roman-lower;
	mso-level-tab-stop:1.5in;
	mso-level-number-position:right;
	text-indent:-9.0pt;}
@list l0:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1
	{mso-list-id:1652177182;
	mso-list-type:hybrid;
	mso-list-template-ids:-481231654 760502080 67698713 67698715 67698703 67698713 67698715 67698703 67698713 67698715;}
@list l1:level1
	{mso-level-number-format:roman-upper;
	mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	margin-left:1.5in;
	text-indent:-.5in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoTitle>Changes for QMP Version 2</p>

<p class=MsoSubtitle>Modified: Nov 2, 2004</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.5in;mso-list:l0 level1 lfo1;
tab-stops:list .75in'><![if !supportLists]>I.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>API Clarifications</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Sending from / to overlapping buffers</p>

<p class=MsoNormal style='margin-left:1.0in'>Sending from overlapping buffers
is allowed. Sending to overlapping buffers simultaneously from one or more
nodes is undefined (considered an undetected error).</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>Starting a second send (separate handle) to the same adjacent
node before the first completes, or a second receive before the first complete,
is allowed.</p>

<p class=MsoNormal style='margin-left:1.0in'>The second send/receive start
function is allowed to block.<span style="mso-spacerun: yes">  </span>That is,
the implementation is not required to implement an I/O queue to support this
behavior.</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Starting a handle twice before the first operation completes
is undefined.</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>d.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>Disallow mixing single operations and multiple operations
containing those single operations.<span style="mso-spacerun: yes"> 
</span>Example:</p>

<p class=MsoBodyTextIndent3>hnd[0] = QMP_declare_send_relative(...); <br>
hnd[1] = QMP_declare_send_relative(...); <br>
big = QMP_declare_multiple(hnd, 2); <br>
.... <br>
QMP_start(hnd[0]); <br>
.... <br>
QMP_start(hnd[1]); <br>
.... <br>
QMP_wait(big);</p>

<p class=MsoBodyTextIndent2>Justification: mixed operations don’t allow full
optimization of multiple operation.</p>

<p class=MsoBodyTextIndent2><i>This mixed operation was proposed to optimize
code behavior in waiting for operations to complete in any order.<span
style="mso-spacerun: yes">  </span>This will now be addressed by a new function
(below).<o:p></o:p></i></p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>e.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Use of declare_multiple invalidates the individual I/O handles
(thus making mixed mode impossible) and subsequent operations on the individual
I/O handles are undefined.<span style="mso-spacerun: yes"> 
</span>declare_multiple will free the individual I/O handles (user will not
have to do this)</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>f.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Recursive use of declare_multiple is allowed (but invalidates
the inputs) and the ordering of individual messages if multiple messages are
going to / coming from a single destination</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>g.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>For QMP_declare_logical_topology() add a clarification on what
is legal:</p>

<p class=MsoBodyTextIndent2>&quot;The implementation should re-order dimensions
and support logical machines with a number of dimensions different from the
allocated machine if the hardware can support it.<span style="mso-spacerun:
yes">  </span>If re-ordering of dimensions occurs, the implementation must do
the appropriate mapping for send relative operations.<span style="mso-spacerun:
yes">  </span>On the QCDOC it is expected that only the logical machine
declared in the environment will give success on this call (sizes must match
exactly).&quot;</p>

<p class=MsoBodyTextIndent2 style='margin-left:0in'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyTextIndent2><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>h.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>Eliminate use of types like QMP_u32_t in the spec except for
needed opaque types.</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Change global_xor to xor_ulong(ulong * val).</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>j.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Use other standard types where appropriate (size_t for block
size, off_t for stride)</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>k.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>stride is allowed to be negative; stride is the difference is
block starting addresses</p>

<p class=MsoBodyTextIndent2 style='margin-left:0in'><span style='mso-tab-count:
2'>                     </span>(QCDOC to confirm they can live with this,
possibly with software mapping)</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>l.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Drop use of <span style='font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:Helvetica;mso-bidi-font-family:"Times New Roman"'>QMP_SMP_ONE_ADDRESS
</span>and <span style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:
Helvetica;mso-bidi-font-family:"Times New Roman"'>QMP_SMP_MULTIPLE_ADDRESS</span>
in QMP_init_msg_passing. Should know this from the environment: MPI_run
specifies how many processes per node to start.</p>

<p class=MsoBodyTextIndent2>Follow MPI_init_thread:</p>

<p class=MsoBodyTextIndent2 style='text-indent:.5in'>Use QMP_thread_single /
funneled / serialized / multi</p>

<p class=MsoBodyTextIndent2 style='text-indent:.5in'>2 parameters: requested, provided
thread level</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>m.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;
</span><![endif]>Clarify requirements for valid global reduction functions:
must be associative and implied function arg ordering is node rank.</p>

<p class=MsoNormal style='margin-left:1.0in'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.5in;mso-list:l0 level1 lfo1;
tab-stops:list .75in'><![if !supportLists]>II.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>API Modifications</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Add missing array length argument:</p>

<p class=MsoNormal style='margin-top:6.0pt;margin-right:.7in;margin-bottom:
0in;margin-left:1.5in;margin-bottom:.0001pt;text-indent:-.5in'><span
style='font-size:10.0pt;mso-bidi-font-size:12.0pt;font-family:Helvetica;
mso-bidi-font-family:"Times New Roman"'>QMP_msgmem_t
QMP_declare_strided_array_msgmem (void ** base,<span style="mso-spacerun:
yes">               </span>QMP_u32_t* blksize, QMP_u32_t *nblocks, QMP_u32_t*
stride);</span> </p>

<p class=MsoNormal style='margin-left:1.0in'>change to </p>

<p class=MsoBlockText>QMP_msgmem_t QMP_declare_strided_array_msgmem (void **
base, size_t * blksize, int *nblocks, ptrdiffs_t* stride, int n);</p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.5in;mso-list:l0 level1 lfo1;
tab-stops:list .75in'><![if !supportLists]>III.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>API Additions</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>add routine QMP_wait_all (handle *, int len)</p>

<p class=MsoNormal style='margin-left:1.0in'>This routine provides the
requested capability to wait for I/O on all of the input handles without a
deadlock.<span style="mso-spacerun: yes">  </span><i>(do we need wait_any ?)</i></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>add routine QMP_abort() </p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>void QMP_abort(int exit_code)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>void QMP_abort_string(int
exit_code, char* string)</span> </p>

<p class=MsoNormal style='margin-left:1.0in'>and the C++ has an null defaulted
2<sup>nd</sup> arg which is a string.<span style="mso-spacerun: yes"> 
</span>This routine kills all processes, used to abnormally terminate a job;
like exit() but attempts some cleanup. </p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>add routine to specify additional application alignment
requirements:</p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>void *QMP_allocate_memory (size_t
nb);<span style="mso-spacerun: yes">  </span>(replaces old allocate_aligned)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>void *QMP_allocate_aligned_memory
(size_t nb, int min_align, int flags);<o:p></o:p></span></p>

<p class=MsoBodyTextIndent2>if min_align = QMP_DEFAULT_MEMALIGN, it uses the
default; specified in bytes</p>

<p class=MsoNormal style='margin-left:.75in'><span style='mso-tab-count:1'>     </span>flags
= bool for type of memory, etc. QMP_DEFAULT_MEMFLAGS</p>

<p class=MsoNormal style='margin-left:.75in'><span style='mso-tab-count:1'>     </span>(bits
to be defined later)</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>d.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>add routine QMP_verbose() to set new (return old) verbosity
level for implementations messages to stderr</p>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
mso-bidi-font-size:12.0pt;font-family:Arial'>&nbsp;&nbsp;
int&nbsp;&nbsp;QMP_verbose(int)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 = no messages <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 = only a few terse messages <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 = most verbose, lots of diagnostics</span> </p>

<p class=MsoNormal style='margin-left:1.0in'>(current implementation is
QMP_verbose(bool) with void return) </p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>e.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>add convenience routines:<br>
<br>
<span style='font-family:Arial'>&nbsp;&nbsp;
int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QMP_printf&nbsp; (const
char* format,...); <br>
&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
QMP_fprintf&nbsp; (FILE* stream, const char* format,...); <br>
&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QMP_info&nbsp;
(int verbose, const char* format,...);<span style="mso-spacerun: yes">   
</span>(to stdout)<br>
&nbsp;&nbsp; int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
QMP_error&nbsp; (const char* format,...);<span style="mso-spacerun:
yes">                      </span>(to stderr)</span></p>

<p class=MsoNormal style='margin-left:.75in'><span style='font-family:Arial'>{<br>
&nbsp;&nbsp; void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QMP_error_exit&nbsp; (const
char* format,...); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Reports error messages and quits. <br>
&nbsp;&nbsp; void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; QMP_fatal&nbsp; (QMP_u32_t
rank, const char* format,...);<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:.75in'><span style='font-family:Arial'>}<o:p></o:p></span></p>

<p class=MsoBodyTextIndent2>These routines all tag output messages with node
number, and total number of nodes, and hostname.</p>

<p class=MsoNormal style='margin-left:.75in'><span style='mso-tab-count:1'>     </span>“(node#):
the_string”</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>f.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>error handler function: ???</p>

<p class=MsoNormal style='margin-left:.75in'><span style='font-family:Arial'><span
style="mso-spacerun: yes">        </span>QMP_errfuncptr_t<span
style="mso-spacerun: yes">  </span>QMP_set_error_function (QMP_errfuncptr_t
funcptr);</span></p>

<p class=MsoBodyTextIndent2>??? this function is called anytime an error is
detected, prior to returning the error to the caller; </p>

<p class=MsoBodyTextIndent2><span style="mso-spacerun: yes">  
</span>QMP_status function (int code);</p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>g.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>add convenience routine</p>

<p class=MsoNormal style='margin-left:81.0pt'>QMP_bool_t&nbsp; QMP_is_primary_node&nbsp;
(void); </p>

<p class=MsoNormal style='margin-left:.75in;text-indent:-.5in;mso-list:l0 level1 lfo1;
tab-stops:list .75in'><![if !supportLists]>IV.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Implementation Changes</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>a.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>drop support for QMP-GM</p>

<p class=MsoBodyTextIndent2>Justification: the performance advantages do not
justify the cost of finishing the debugging of this implementation, because
QMP-MPICH can support GM (myrinet).&nbsp; We no longer anticipate that GM will
be a significant platform for QMP.&nbsp; Instead, the major platforms will be:</p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:-1.5in;mso-text-indent-alt:
-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>MPICH
(portability, support of legacy platforms, including myrinet, and initial
support of Infiniband) </p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:-1.5in;mso-text-indent-alt:
-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>gigE
mesh (since this cannot be supported by MPICH) </p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:-1.5in;mso-text-indent-alt:
-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>QCDOC
(ditto) </p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:-1.5in;mso-text-indent-alt:
-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iv.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>Infiniband,
if it appears that we can gain significant advantages over MPICH by such an
implementation </p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>b.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>Finish QMP-MPICH and QMP-VIA and QMP-QCDOC</p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>c.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;
</span><![endif]>Add a new implementation to support running on a single node
without using QMP-MPICH (which requires an MPICH implementation) -- i.e.
satisfy all references, but support no messaging. </p>

<p class=MsoBodyTextIndent2 style='text-indent:-.25in;mso-list:l0 level2 lfo1;
tab-stops:list 1.0in'><![if !supportLists]>d.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;
</span><![endif]>explicit support for profiling for all implementation: </p>

<p class=MsoBodyTextIndent2 style='margin-left:1.5in;text-indent:-1.5in;
mso-text-indent-alt:-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>i.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>Files
QMP_P_MPI.h and QMP_P_GM.h (and others): <br>
&nbsp;&nbsp;&nbsp; Insert, near the top, a line with&nbsp;&nbsp; #include
&quot;QMP_profiling.h&quot; <br>
&nbsp;&nbsp;&nbsp;&nbsp;(conditioned by ifdef???) </p>

<p class=MsoBodyTextIndent2 style='margin-left:1.5in;text-indent:-1.5in;
mso-text-indent-alt:-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>ii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>Add
to the set of header files the file &quot;QMP_profiling.h&quot; which <br>
&nbsp;&nbsp;&nbsp; has contents such as: <br>
<br>
&nbsp;&nbsp;&nbsp; #pragma weak QMP_start = PQMP_start <br>
&nbsp;&nbsp;&nbsp; #undef QMP_start <br>
&nbsp;&nbsp;&nbsp; #define QMP_start PQMP_start <br>
<br>
&nbsp;&nbsp;&nbsp; This should be repeated for each QMP function of interest. <br>
&nbsp;&nbsp;&nbsp; It will enable profiling tools to define 'QMP_start' and let
<br>
&nbsp;&nbsp;&nbsp; the tools do whatever they want to do before calling the
real <br>
&nbsp;&nbsp;&nbsp; library function, redefined as 'PQMP_start' </p>

<p class=MsoBodyTextIndent2 style='margin-left:1.5in;text-indent:-1.5in;
mso-text-indent-alt:-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iii.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>Add
to the library the dummy function &quot;int QMP_profcontrol (int level)&quot;
to set level and return previous level; 0=off, 1=on</p>

<p class=MsoBodyTextIndent2 style='margin-left:1.5in;text-indent:-1.5in;
mso-text-indent-alt:-9.0pt;mso-list:l0 level3 lfo1;tab-stops:list 1.5in'><![if !supportLists]><span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span>iv.<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp; </span><![endif]>add
double QMP_get_total_qmp_time(void); which would return the total time spent in
QMP.<span style="mso-spacerun: yes">  </span>This could just return 0 if the
QMP isn't profiled but would return the correct result for a profiled
library.<span style="mso-spacerun: yes">  </span>This could return time in
seconds or we could use an int return for the time in some fraction of a sec.
Maybe also a void QMP_reset_total_qmp_time(void);</p>

<p class=MsoBodyTextIndent2 style='margin:0in;margin-bottom:.0001pt'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></p>

</div>

</body>

</html>
